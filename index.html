<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>贪吃蛇</title>
</head>
<style>
	p.title {text-align: center; font-size: 30px; color: orange;}
	div#Bckgrnd {width: 600px; height: 600px; border: 1px solid #ccc; margin: 30px auto; position: relative;}
	div#Bckgrnd div {width: 28px; height: 28px; background-color: #000; position: absolute; border: 1px solid green;}
</style>

<body>
	<p class="title">贪吃蛇</p>
	<div id="Bckgrnd">
	</div>
	<a href="task1">内容测试页</a>
	<a href="task2/task2.html">样式测试页</a>
	<a href="task13">录入数字</a>
	<a href="task14">js处理后的列表</a>
	<a href="task15">js处理数据后的排序</a>
</body>

<script>
window.onload = function () {
	var snack = new Snack;
	snack.render();
	snack.init();
}

function Snack () {
	this.bckgrnd = document.getElementById('Bckgrnd');

	this.data = [
		[0, 0],
		[30, 0],
		[60, 0]
	];

	this.switch = 0;

	this.ev = null;

	this.timmer = null;

	this.recDir = 'right';
}

Snack.prototype.init = function () {
	var This = this;
	document.onkeydown = function (ev) {
		this.ev = ev || window.event;

		if (ev && ev.keyCode == 13) {
			This.switch = !This.switch;
			if (This.switch == 1) {
				This.clear();
				This.move(This.recDir);
			} else {
				This.clear();
			}
		}

		if (This.switch == 1 && ev) {
			switch (ev.keyCode) {
				case 38 : 
				if (This.recDir != 'down') {
					This.recDir = 'up';
					This.move('up');
				};
				break;
				case 40 : 
				if (This.recDir != 'up') {
					This.recDir = 'down';
					This.move('down');
				};
				break;
				case 37 : 
				if (This.recDir != 'right') {
					This.recDir = 'left';
					This.move('left');
				}
				;
				break;
				case 39 : 
				if (This.recDir != 'left') {
					This.recDir = 'right';
					This.move('right');
				}
				;
				break;
			}
		}

	}
}

Snack.prototype.clear = function () {
	clearInterval(this.timmer);
	this.timmer = null;
}

Snack.prototype.move = function (recDir) {
	this.clear();
	var This = this;
	if (recDir == 'right') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][0] <= This.bckgrnd.offsetWidth - 60) {
				This.data[len-1][0] += 30;
			} else {
				This.data[len-1][0] = 0;
			}
			This.render();
		}, 300);		
	} else if (recDir == 'left') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][0] >= 30) {
				This.data[len-1][0] -= 30;
			} else {
				This.data[len-1][0] = This.bckgrnd.offsetWidth - 30;
			}
			This.render();
		}, 300);
	} else if (recDir == 'down') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][1] <= This.bckgrnd.offsetHeight - 60) {
				This.data[len-1][1] += 30;
			} else {
				This.data[len-1][1] = 0;
			}
			This.render();
		}, 300);
	} else if (recDir == 'up') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][1] >= 30) {
				This.data[len-1][1] -= 30;
			} else {
				This.data[len-1][1] = This.bckgrnd.offsetHeight - 30;
			}
			This.render();
		}, 300);
	}

}

Snack.prototype.render = function () {
	this.bckgrnd.innerHTML = '';
	var node = null;
	var len = this.data.length;
	for (var i=0; i<len-1; i++) {
		node = document.createElement('div');
		node.style.left = this.data[i][0] + 'px';
		node.style.top = this.data[i][1] + 'px';
		node.style.backgroundColor = 'orange';
		this.bckgrnd.appendChild(node);
	}
	node = document.createElement('div');
	node.style.left = this.data[len-1][0] + 'px';
	node.style.top = this.data[len-1][1] + 'px';
	node.style.backgroundColor = 'red';
	this.bckgrnd.appendChild(node);
}

</script>

</html>
