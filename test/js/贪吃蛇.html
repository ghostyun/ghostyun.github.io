<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>贪吃蛇</title>
</head>
<style>
	p.title {text-align: center; font-size: 30px; color: orange;}
	div#Bckgrnd {width: 600px; height: 600px; border: 1px solid #ccc; margin: 30px auto; position: relative;}
	div#Bckgrnd div {width: 28px; height: 28px; background-color: #000; position: absolute; border: 1px solid green;}
	div#Bckgrnd span {display: inline-block; width: 28px; height: 28px; border: 1px solid #ccc; background: pink; position: absolute; -moz-border-radius: 14px; -webkit-border-radius: 14px; border-radius:14px; line-height: 28px; font-size: 10px; text-align: center;}
</style>

<body>
	<p class="title">贪吃蛇</p>
	<div id="Bckgrnd">
	</div>
</body>

<script>
window.onload = function () {
	var snack = new Snack;
	snack.render();
	snack.init();

	var egg = new CreateEgg(snack.getData());

}

function Snack () {
	this.bckgrnd = document.getElementById('Bckgrnd');

	this.data = [
		[0, 0],
		[30, 0],
		[60, 0]
	];

	this.switch = 0;

	this.ev = null;

	this.timmer = null;

	this.recDir = 'right';
}

Snack.prototype.getData = function () {
	return this.data;
}

Snack.prototype.init = function () {
	var This = this;
	document.onkeydown = function (ev) {
		this.ev = ev || window.event;

		if (ev && ev.keyCode == 13) {
			This.switch = !This.switch;
			if (This.switch == 1) {
				This.clear();
				This.move(This.recDir);
			} else {
				This.clear();
			}
		}

		if (This.switch == 1 && ev) {
			switch (ev.keyCode) {
				case 38 : 
				if (This.recDir != 'down') {
					This.recDir = 'up';
					This.move('up');
				};
				break;
				case 40 : 
				if (This.recDir != 'up') {
					This.recDir = 'down';
					This.move('down');
				};
				break;
				case 37 : 
				if (This.recDir != 'right') {
					This.recDir = 'left';
					This.move('left');
				}
				;
				break;
				case 39 : 
				if (This.recDir != 'left') {
					This.recDir = 'right';
					This.move('right');
				}
				;
				break;
			}
		}

	}
}

Snack.prototype.clear = function () {
	clearInterval(this.timmer);
	this.timmer = null;
}

Snack.prototype.move = function (recDir) {
	this.clear();
	var This = this;
	if (recDir == 'right') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][0] <= This.bckgrnd.offsetWidth - 60) {
				This.data[len-1][0] += 30;
			} else {
				This.data[len-1][0] = 0;
			}
			This.render();
		}, 300);		
	} else if (recDir == 'left') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][0] >= 30) {
				This.data[len-1][0] -= 30;
			} else {
				This.data[len-1][0] = This.bckgrnd.offsetWidth - 30;
			}
			This.render();
		}, 300);
	} else if (recDir == 'down') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][1] <= This.bckgrnd.offsetHeight - 60) {
				This.data[len-1][1] += 30;
			} else {
				This.data[len-1][1] = 0;
			}
			This.render();
		}, 300);
	} else if (recDir == 'up') {
		this.timmer = setInterval(function () {
			var len = This.data.length;

			for (var i=0; i<len-1; i++) {
				This.data[i][0] = This.data[i+1][0];
				This.data[i][1] = This.data[i+1][1];
			}

			if (This.data[len-1][1] >= 30) {
				This.data[len-1][1] -= 30;
			} else {
				This.data[len-1][1] = This.bckgrnd.offsetHeight - 30;
			}
			This.render();
		}, 300);
	}

}

Snack.prototype.render = function () {
	var aDiv = this.bckgrnd.getElementsByTagName('div');
	for (var i=0; i<aDiv.length; i++) {
		this.bckgrnd.removeChild(aDiv[i]);
	}
	var node = null;
	var len = this.data.length;
	for (var i=0; i<len-1; i++) {
		node = document.createElement('div');
		node.style.left = this.data[i][0] + 'px';
		node.style.top = this.data[i][1] + 'px';
		node.style.backgroundColor = 'orange';
		this.bckgrnd.appendChild(node);
	}
	node = document.createElement('div');
	node.style.left = this.data[len-1][0] + 'px';
	node.style.top = this.data[len-1][1] + 'px';
	node.style.backgroundColor = 'red';
	this.bckgrnd.appendChild(node);
}

Snack.prototype.add = function () {
	this.data.push([this.data[0][0], this.data[0][1]]);
}

Snack.prototype.isEat = function () {

}

function CreateEgg (data) {
	this.bckgrnd = document.getElementById('Bckgrnd');
	this.pos = {x:0, y:0};
	this.init(data);
	this.render();
}

CreateEgg.prototype.init = function (data) {
	this.pos.x = (Math.floor(Math.random() * (this.bckgrnd.offsetWidth-30) / 30)) * 30;
	this.pos.y = (Math.floor(Math.random() * (this.bckgrnd.offsetWidth-30) / 30)) * 30;
	for (var i=0; i<data.length; i++) {
		if (this.pos.x == data[i][0] && this.pos.y == data[i][1]) {
			this.init(data);
			return;
		}
	}	
}

CreateEgg.prototype.getPos = function () {
	return this.pos;
}

CreateEgg.prototype.render = function () {
	var node = document.createElement('span');
	node.style.left = this.pos.x + 'px';
	node.style.top = this.pos.y + 'px';
	node.innerHTML = 'egg';
	this.bckgrnd.appendChild(node);
}

CreateEgg.prototype.clear = function () {

}

</script>

</html>